#N canvas 804 52 1051 681 12;
#X obj 53 144 netreceive -u -f;
#X obj 731 81 text define connections;
#X obj 53 175 route call;
#X obj 53 274 list append;
#X obj 36 368 text search connections 0;
#X obj 36 394 sel -1;
#X obj 479 45 loadbang;
#X obj 479 99 metro 1000;
#X obj 479 129 f;
#X obj 480 78 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 479 154 + 1;
#X obj 479 179 mod 1e+06;
#X msg 422 76 30;
#X obj 422 101 until;
#X obj 731 106 text define this-msg;
#X obj 256 425 text set this-msg;
#X obj 266 402 print got-call;
#X obj 213 584 text set connections 1e+09;
#X obj 199 529 text get this-msg;
#X msg 200 503 0;
#X obj 365 347 r secs;
#X floatatom 507 208 5 0 0 0 - - -;
#X obj 484 250 s secs;
#X msg 731 55 clear;
#X obj 199 645 print add-new-line;
#N canvas 32 106 585 498 prune-connections 0;
#X msg 288 39 \; prune-connections bang;
#X obj 87 34 r prune-connections;
#X obj 341 229 r secs;
#X msg 158 229 \$4 \$7;
#X obj 160 337 sel 1;
#X obj 54 410 text delete connections;
#X obj 160 262 expr ($f1 < 0 || (($f3-$f1+1000000)%1000000) > 30) &&
($f2 < 0 || (($f3-$f2+1000000)%1000000) > 30), f 33;
#X obj 88 87 text size connections;
#X obj 87 59 t b b;
#X obj 88 113 until;
#X obj 159 202 text get connections;
#X obj 88 138 f;
#X obj 167 164 + 1;
#X obj 114 163 t f f;
#X msg 160 60 0;
#X obj 55 380 f;
#X connect 1 0 8 0;
#X connect 2 0 6 2;
#X connect 3 0 6 0;
#X connect 4 0 15 0;
#X connect 6 0 4 0;
#X connect 7 0 9 0;
#X connect 8 0 7 0;
#X connect 8 1 14 0;
#X connect 9 0 11 0;
#X connect 10 0 3 0;
#X connect 11 0 13 0;
#X connect 12 0 11 1;
#X connect 13 0 10 0;
#X connect 13 1 15 1;
#X connect 13 1 12 0;
#X connect 14 0 11 1;
#X connect 15 0 5 0;
#X connect 15 0 11 1;
#X restore 725 201 pd prune-connections;
#X obj 51 300 t b s l b;
#X msg 52 118 listen \$1;
#X floatatom 52 92 5 0 0 0 - - -;
#X msg 116 67 0;
#X obj 483 358 r reply;
#X obj 479 554 netsend -u;
#X obj 559 207 mod 30;
#X obj 559 232 sel 0;
#X obj 559 285 s prune-connections;
#X obj 559 257 spigot;
#X obj 620 231 loadbang;
#X obj 620 255 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 266 378 spigot;
#X obj 326 377 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 26 265 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X obj 484 390 unpack s 0 0 s 0 0;
#X obj 567 420 addrmunger;
#X obj 484 419 addrmunger;
#X obj 484 451 pack s 0 0 s 0 0;
#X obj 749 495 spigot;
#X obj 809 497 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 588 552 spigot;
#X obj 650 553 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 35 41 loadbang;
#X msg 36 64 3840;
#X msg 479 502 disconnect \, connect \$1 \$2 3840 \, send peer-addr
\$4 \$5 \$2 \, disconnect, f 35;
#X obj 591 580 print to-netsend;
#X obj 349 376 loadbang;
#N canvas 1211 400 653 517 simulate-calls 0;
#X obj 96 461 outlet;
#X obj 403 427 text define -k test1;
#A set zzz ::ffff:104.186.255.171 52350 0 178290 \; zzz ::ffff:104.186.255.171
52350 0 178291 \; zzz ::ffff:104.186.255.171 52350 0 178292 \; zzz
::ffff:76.126.215.138 62351 0 178292 \; zzz ::ffff:104.186.255.171
52350 0 178293 \; zzz ::ffff:76.126.215.138 51247 0 179536 \; zzz ::ffff:104.186.255.171
61535 0 177698 \; zzz ::ffff:76.126.215.138 61129 0 177698 \; zzz ::ffff:104.186.255.171
61535 0 177699 \; zzz ::ffff:76.126.215.138 65301 0 177806 \;;
#X msg 401 382 read -c /tmp/foo.txt;
#X obj 129 338 text sequence test1;
#X msg 133 314 line 0 \, auto;
#X obj 183 458 s secs;
#X obj 248 392 text get test1;
#X msg 255 362 0;
#X obj 92 253 list;
#X obj 100 415 list split 4;
#X obj 258 464 print xxx;
#X obj 242 490 print yyy;
#X msg 92 77 zzz 1 ::ffff:104.186.255.171 1234 100;
#X msg 119 111 zzz 2 ::ffff:104.186.255.172 2345 100;
#X msg 131 143 zzz 3 ::ffff:104.186.255.172 4365 100;
#X msg 135 180 zzz 3 ::ffff:104.186.255.172 7658 100;
#X connect 2 0 1 0;
#X connect 3 0 9 0;
#X connect 4 0 3 0;
#X connect 6 0 9 0;
#X connect 7 0 6 0;
#X connect 8 0 9 0;
#X connect 9 0 0 0;
#X connect 9 0 11 0;
#X connect 9 1 5 0;
#X connect 9 1 10 0;
#X connect 12 0 8 0;
#X connect 13 0 8 0;
#X connect 14 0 8 0;
#X connect 15 0 8 0;
#X restore 148 270 pd simulate-calls;
#X obj 486 475 t l l;
#X obj 36 419 s add-new-line;
#X obj 28 456 r add-new-line;
#X obj 89 395 s matched-line;
#N canvas 590 101 1092 864 matched-line 0;
#X obj 335 123 text get this-msg;
#X obj 389 68 v matched-line;
#X obj 335 236 sel -;
#X obj 337 69 t b f;
#X obj 521 127 text get connections;
#X obj 570 237 sel -;
#X msg 383 235 symbol \$2;
#X obj 340 592 text get this-msg;
#X obj 587 588 text get this-msg;
#X msg 340 566 0;
#X msg 587 562 0;
#X obj 635 665 v matched-line;
#X obj 605 694 text set connections;
#X obj 335 385 text get this-msg;
#X obj 335 414 sel;
#X obj 464 388 route float;
#X obj 314 41 t b f b;
#X obj 21 424 spigot;
#X obj 68 493 text delete connections;
#X obj 21 466 v matched-line;
#X msg 464 236 \$3;
#X obj 603 813 s reply;
#X obj 20 136 t b b;
#X obj 52 163 v matched-line;
#X obj 52 188 text get connections;
#X obj 157 321 sel -1;
#X obj 37 320 sel -1;
#X msg 37 295 \$4;
#X obj 20 109 spigot;
#X obj 21 491 t b f;
#X obj 53 523 print delete-line;
#X obj 584 814 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 335 150 t s s, f 16;
#X obj 335 210 spigot;
#X obj 37 269 spigot;
#X obj 52 213 t l l;
#X obj 586 637 t b l b;
#X obj 583 733 v matched-line;
#X obj 583 759 text get connections;
#X obj 390 671 v matched-line;
#X obj 360 700 text set connections;
#X obj 341 643 t b l b;
#X obj 337 733 v matched-line;
#X obj 337 759 text get connections;
#X msg 498 672 1;
#X obj 315 241 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 547 238 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 831 591 text get this-msg;
#X msg 831 565 0;
#X obj 883 680 v matched-line;
#X obj 853 709 text set connections;
#X obj 833 646 t b l b;
#X msg 989 679 1;
#X obj 21 549 s add-new-line;
#X obj 359 810 s reply;
#X obj 340 811 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 314 15 r matched-line;
#X msg 503 57 \; need-reply 1;
#X obj 73 111 r need-reply;
#X obj 353 182 r need-reply;
#X obj 101 216 r need-reply;
#X obj 71 424 r need-reply;
#X obj 831 539 r replace-whole-line;
#X obj 834 735 v matched-line;
#X obj 834 761 text get connections;
#X obj 856 812 s reply;
#X obj 837 813 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 368 417 s replace-whole-line;
#X obj 157 345 s replace-peer-2;
#X obj 585 537 r replace-peer-2;
#X obj 340 542 r replace-peer-1;
#X obj 37 345 s replace-peer-1;
#X obj 335 444 s replace-peer-1;
#X msg 619 238 symbol \$6;
#X msg 699 238 \$7;
#X text 365 96 ipaddr;
#X text 372 357 port;
#X obj 335 292 text get this-msg;
#X text 372 264 ID;
#X obj 335 321 sel;
#X msg 496 236 \$4;
#X obj 476 301 route float;
#X msg 731 238 \$8;
#X obj 570 390 text get this-msg;
#X obj 570 419 sel;
#X obj 699 393 route float;
#X obj 603 422 s replace-whole-line;
#X text 607 362 port;
#X obj 570 297 text get this-msg;
#X text 607 269 ID;
#X obj 570 326 sel;
#X obj 711 306 route float;
#X text 412 213 ipaddr;
#X text 466 212 port;
#X text 505 213 ID;
#X text 631 219 ipaddr;
#X text 695 217 port;
#X text 734 218 ID;
#X obj 570 449 s replace-peer-2;
#X text 615 10 matched-line is sent if a line in "connections" matches
the call name of the incoming request. First check if the caller is
already in the line \, and if so just replace that caller's fields.
OTOH \, If the call matches an existing ipaddr and ID but the port
has changed \, maybe it's not the same caller after all - in this case
replace the entire line.;
#X text 12 10 if no party in the call matches incoming request \, and
if there's only one caller in the call \, we're the other caller \,
so add us to the connection, f 32;
#X text 17 574 if caller isn't in the call and there are already 2
people in the call \, there are 3 callers. Perhaps one of them has
since disappeared. In hopes of this \, reset the call and hope only
one other caller is still requesting a call., f 40;
#X text 773 124 The flag "need-reply" is initialized to 1 \, but as
soon as something in this chain of attempts generates a reply the flag
is cleared. This stops the search for a suitable action. This would
be an if-then-else with 5 clauses if we were using a text-based programming
language instead of Pd., f 43;
#X msg 584 785 list \$6 \$7 \$9 \$2 \$3 \$5;
#X msg 835 787 list \$2 \$3 \$5 \$6 \$7 \$9;
#X text 373 496 Here are the three possible actions we can take in
response. We reply with the caller's (ipaddr \, port \, time) and the
peer's (ipaddr \, port \, time)., f 72;
#X msg 742 666 5;
#X msg 338 785 list \$2 \$3 \$5 \$6 \$7 \$9;
#X obj 33 448 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X msg 156 297 \$9;
#X msg 335 96 0 2;
#X msg 335 358 0 3;
#X msg 335 265 0 1;
#X msg 570 270 0 1;
#X msg 570 363 0 3;
#X msg 341 617 list \$3 \$4 \$2 \$5;
#X msg 586 612 list \$3 \$4 \$2 \$5;
#X msg 830 615 list \$3 \$4 \$2 \$5 - 0 -1 0;
#X connect 0 0 32 0;
#X connect 2 0 45 0;
#X connect 2 0 112 0;
#X connect 3 0 110 0;
#X connect 3 1 1 0;
#X connect 3 1 4 0;
#X connect 4 0 6 0;
#X connect 4 0 73 0;
#X connect 4 0 20 0;
#X connect 4 0 74 0;
#X connect 4 0 80 0;
#X connect 4 0 82 0;
#X connect 5 0 46 0;
#X connect 5 0 113 0;
#X connect 6 0 2 1;
#X connect 7 0 115 0;
#X connect 8 0 116 0;
#X connect 9 0 7 0;
#X connect 10 0 8 0;
#X connect 11 0 12 1;
#X connect 13 0 14 0;
#X connect 14 0 72 0;
#X connect 14 1 67 0;
#X connect 15 0 14 1;
#X connect 16 0 28 0;
#X connect 16 1 3 0;
#X connect 16 2 57 0;
#X connect 17 0 19 0;
#X connect 17 0 108 0;
#X connect 19 0 29 0;
#X connect 20 0 15 0;
#X connect 22 0 17 0;
#X connect 22 1 23 0;
#X connect 23 0 24 0;
#X connect 24 0 35 0;
#X connect 25 0 68 0;
#X connect 26 0 71 0;
#X connect 27 0 26 0;
#X connect 28 0 22 0;
#X connect 29 0 53 0;
#X connect 29 1 18 0;
#X connect 29 1 30 0;
#X connect 32 0 33 0;
#X connect 32 1 5 0;
#X connect 33 0 2 0;
#X connect 34 0 27 0;
#X connect 35 0 34 0;
#X connect 35 1 109 0;
#X connect 36 0 37 0;
#X connect 36 1 12 0;
#X connect 36 2 106 0;
#X connect 36 2 11 0;
#X connect 37 0 38 0;
#X connect 38 0 103 0;
#X connect 39 0 40 1;
#X connect 41 0 42 0;
#X connect 41 1 40 0;
#X connect 41 2 44 0;
#X connect 41 2 39 0;
#X connect 42 0 43 0;
#X connect 43 0 107 0;
#X connect 44 0 40 2;
#X connect 47 0 117 0;
#X connect 48 0 47 0;
#X connect 49 0 50 1;
#X connect 51 0 63 0;
#X connect 51 1 50 0;
#X connect 51 2 52 0;
#X connect 51 2 49 0;
#X connect 52 0 50 2;
#X connect 56 0 16 0;
#X connect 58 0 28 1;
#X connect 59 0 33 1;
#X connect 60 0 34 1;
#X connect 61 0 17 1;
#X connect 62 0 48 0;
#X connect 63 0 64 0;
#X connect 64 0 104 0;
#X connect 69 0 10 0;
#X connect 70 0 9 0;
#X connect 73 0 5 1;
#X connect 74 0 85 0;
#X connect 77 0 79 0;
#X connect 79 0 111 0;
#X connect 80 0 81 0;
#X connect 81 0 79 1;
#X connect 82 0 91 0;
#X connect 83 0 84 0;
#X connect 84 0 98 0;
#X connect 84 1 86 0;
#X connect 85 0 84 1;
#X connect 88 0 90 0;
#X connect 90 0 114 0;
#X connect 91 0 90 1;
#X connect 103 0 21 0;
#X connect 103 0 31 0;
#X connect 104 0 66 0;
#X connect 104 0 65 0;
#X connect 106 0 12 2;
#X connect 107 0 55 0;
#X connect 107 0 54 0;
#X connect 109 0 25 0;
#X connect 110 0 0 0;
#X connect 111 0 13 0;
#X connect 112 0 77 0;
#X connect 113 0 88 0;
#X connect 114 0 83 0;
#X connect 115 0 41 0;
#X connect 116 0 36 0;
#X connect 117 0 51 0;
#X restore 726 173 pd matched-line;
#X msg 619 454 \; need-reply 0;
#X obj 28 483 t b b;
#X obj 29 512 text size connections;
#X obj 29 537 - 1;
#X obj 28 565 text get connections;
#X obj 50 616 s reply;
#X obj 31 617 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X obj 809 468 loadbang;
#X obj 752 523 print replying;
#X obj 199 618 spigot;
#X obj 259 620 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 285 618 loadbang;
#X obj 20 163 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X text 44 15 listen for incoming messages;
#X msg 71 330 list \$1;
#X text 581 309 was: call-name ip1 port1 time1 ip2 port2 time2;
#X text 583 340 new: call-name ip1 port1 id1 time1 ip2 port2 id2 time2
;
#X text 692 357 \$2;
#X text 722 358 \$3;
#X text 759 358 \$4;
#X text 793 358 \$5;
#X text 834 359 \$6;
#X text 864 360 \$7;
#X text 901 360 \$8;
#X text 935 360 \$9;
#X text 692 323 \$2;
#X text 722 324 \$3;
#X text 759 324 \$4;
#X text 799 323 \$5;
#X text 831 324 \$6;
#X text 868 323 \$7;
#X msg 121 223 0;
#X text 158 212 if no ID it's an old client so assume 0, f 14;
#X msg 29 591 list \$2 \$3 \$5 \$6 \$7 \$9;
#X text 246 306 call-name \, call-ID \, ipaddr-from \, port-from \,
time, f 28;
#X obj 255 347 pack s 0 s 0 0;
#X msg 199 554 list \$1 \$3 \$4 \$2 \$5 - 0 0 -1;
#X obj 53 224 t l b;
#X obj 53 248 pack s 0;
#X obj 53 200 list;
#X connect 0 0 2 0;
#X connect 0 0 72 0;
#X connect 0 1 3 1;
#X connect 2 0 99 0;
#X connect 3 0 26 0;
#X connect 4 0 5 0;
#X connect 5 0 56 0;
#X connect 5 1 58 0;
#X connect 6 0 9 0;
#X connect 7 0 8 0;
#X connect 8 0 10 0;
#X connect 9 0 7 0;
#X connect 10 0 11 0;
#X connect 11 0 8 1;
#X connect 11 0 21 0;
#X connect 11 0 22 0;
#X connect 11 0 32 0;
#X connect 12 0 13 0;
#X connect 13 0 8 0;
#X connect 18 0 96 0;
#X connect 19 0 18 0;
#X connect 20 0 95 4;
#X connect 23 0 1 0;
#X connect 26 0 50 0;
#X connect 26 1 74 0;
#X connect 26 2 95 0;
#X connect 26 3 29 0;
#X connect 27 0 0 0;
#X connect 28 0 27 0;
#X connect 29 0 28 0;
#X connect 30 0 41 0;
#X connect 32 0 33 0;
#X connect 33 0 35 0;
#X connect 35 0 34 0;
#X connect 36 0 37 0;
#X connect 37 0 35 1;
#X connect 38 0 16 0;
#X connect 39 0 38 1;
#X connect 41 0 43 0;
#X connect 41 1 44 1;
#X connect 41 2 44 2;
#X connect 41 3 42 0;
#X connect 41 4 44 4;
#X connect 41 5 44 5;
#X connect 42 0 44 3;
#X connect 43 0 44 0;
#X connect 44 0 55 0;
#X connect 45 0 68 0;
#X connect 46 0 45 1;
#X connect 47 0 52 0;
#X connect 48 0 47 1;
#X connect 49 0 50 0;
#X connect 50 0 28 0;
#X connect 51 0 31 0;
#X connect 51 0 47 0;
#X connect 53 0 39 0;
#X connect 54 0 26 0;
#X connect 55 0 51 0;
#X connect 55 1 45 0;
#X connect 55 1 60 0;
#X connect 57 0 61 0;
#X connect 61 0 62 0;
#X connect 61 1 19 0;
#X connect 62 0 63 0;
#X connect 63 0 64 0;
#X connect 64 0 93 0;
#X connect 67 0 46 0;
#X connect 69 0 24 0;
#X connect 70 0 69 1;
#X connect 71 0 70 0;
#X connect 74 0 4 0;
#X connect 91 0 98 1;
#X connect 93 0 66 0;
#X connect 93 0 65 0;
#X connect 95 0 15 0;
#X connect 95 0 38 0;
#X connect 96 0 17 0;
#X connect 96 0 69 0;
#X connect 97 0 98 0;
#X connect 97 1 91 0;
#X connect 98 0 3 0;
#X connect 98 0 40 0;
#X connect 99 0 97 0;
